<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>لوحة الطالب - إقرا وارتق</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Tajawal', 'Amiri', system-ui, sans-serif;
      background: linear-gradient(135deg, #0d1b2a 0%, #0a1421 100%);
      color: #f0f4f8;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .container { max-width: 900px; margin: 0 auto; }
    header { text-align: center; padding: 30px 0; background: #1b263b; border-radius: 12px; margin-bottom: 30px; border: 1px solid rgba(44,125,160,0.3); }
    .welcome { font-family: 'Amiri', serif; font-size: 2.5rem; color: #d4af37; margin-bottom: 8px; }
    .info { font-size: 1.1rem; color: #94a3b8; }
    .section { background: #1b263b; border-radius: 12px; padding: 24px; margin-bottom: 30px; border: 1px solid rgba(44,125,160,0.3); }
    .section h2 { color: #a5b4fc; margin-bottom: 20px; font-size: 1.5rem; }
    .big-btn { width: 100%; padding: 16px; font-size: 1.2rem; font-weight: 600; border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s; margin: 12px 0; }
    .btn-attendance { background: #22c55e; color: white; }
    .btn-attendance:hover { background: #16a34a; }
    .btn-zoom { background: #3b82f6; color: white; }
    .btn-zoom:hover { background: #2563eb; }
    .btn-results { background: #f59e0b; color: white; }
    .btn-results:hover { background: #d97706; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .status { text-align: center; margin: 12px 0; font-weight: 500; font-size: 1.1rem; }
  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="welcome">مرحباً يا الطالب</div>
    <div class="info">المستوى: ... • كود: ...</div>
  </header>

  <div class="section">
    <h2>تسجيل الحضور</h2>
    <button id="btnAttendance" class="big-btn btn-attendance" data-level="1" disabled>تسجيل حضور اليوم</button>
    <div id="attendanceStatus" class="status">الحضور مغلق حالياً</div>
  </div>

  <div class="section">
    <h2>الحلقة</h2>
    <button id="btnZoom" class="big-btn btn-zoom" data-level="1" disabled>انضم إلى الحلقة</button>
    <div id="zoomStatus" class="status">الحلقة غير متاحة حالياً</div>
  </div>

  <div class="section">
    <h2>نتائجي</h2>
    <button id="btnShowResults" class="big-btn btn-results" data-level="1" disabled>عرض نتائجي</button>
    <div id="resultsContainer"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCjz28veGP4CkFLsLIm0rEoiZWFVBuDBWw",
  authDomain: "iqrawartaqeacademy2026.firebaseapp.com",
  projectId: "iqrawartaqeacademy2026",
  storageBucket: "iqrawartaqeacademy2026.firebasestorage.app",
  messagingSenderId: "920005799542",
  appId: "1:920005799542:web:60b76595f93489f54ff957"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const userNameDisplay = document.querySelector('.welcome');
const levelDisplay = document.querySelector('.info');
const btnAttendance = document.getElementById('btnAttendance');
const attendanceStatus = document.getElementById('attendanceStatus');
const btnZoom = document.getElementById('btnZoom');
const zoomStatus = document.getElementById('zoomStatus');
const btnShowResults = document.getElementById('btnShowResults');
const resultsContainer = document.getElementById('resultsContainer');

auth.onAuthStateChanged(async (user) => {
  if (!user) { window.location.href = 'student-login.html'; return; }

  try {
    const studentDoc = await db.collection('Students').doc(user.uid).get();
    if (!studentDoc.exists) { alert('لم يتم العثور على بياناتك'); return; }

    const studentData = studentDoc.data();
    const studentLevel = studentData.level;

    userNameDisplay.textContent = `مرحباً يا ${studentData.name}`;
    levelDisplay.textContent = `المستوى: ${studentLevel} • كود: ${studentData.code}`;

    btnAttendance.disabled = !studentData.attendanceEnabled;
    attendanceStatus.textContent = studentData.attendanceEnabled ? 'جاهز للتسجيل' : 'الحضور مغلق حالياً';

    btnZoom.disabled = !studentData.zoomEnabled;
    zoomStatus.textContent = studentData.zoomEnabled ? 'الحلقة متاحة الآن' : 'الحلقة غير متاحة حالياً';

    btnShowResults.disabled = !studentData.resultsEnabled;

    // تعطيل العناصر لمستويات أعلى
    const levelButtons = document.querySelectorAll('.big-btn');
    levelButtons.forEach(btn => {
      const btnLevel = parseInt(btn.getAttribute('data-level'));
      if (btnLevel && btnLevel > studentLevel) btn.disabled = true;
    });

  } catch (err) {
    console.error('خطأ في جلب بيانات الطالب:', err);
  }
});

btnAttendance.onclick = () => { alert('تم تسجيل حضورك اليوم'); btnAttendance.disabled = true; };
btnZoom.onclick = () => { alert('فتح رابط الحلقة'); };
btnShowResults.onclick = () => { alert('عرض النتائج'); };
</script>
</body>
</html>